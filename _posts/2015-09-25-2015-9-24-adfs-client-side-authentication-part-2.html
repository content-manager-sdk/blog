---
layout: post
title: ADFS client side authentication (part 2)
categories: []
tags:
- ServiceAPI
- ADFS
- Authentication
status: publish
type: post
published: true
meta: {}
---
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h1>Demo</h1>
<p>This demonstrates the creation of a simple console application which uses ADFS to authenticate and then passes those credentials to the ServiceAPI.  If you are interested in ADAL then read Vittorio Bertocci's <a href="http://www.cloudidentity.com/blog/">blog</a>, particularly <a href="http://www.cloudidentity.com/blog/2013/09/12/active-directory-authentication-library-adal-v1-for-net-general-availability/">this post</a>.  The token cache I use in the below video can be found <a href="https://github.com/AzureADSamples/NativeClient-DotNet/blob/master/TodoListClient/FileCache.cs">here</a>, the code I wrote below is <a href="https://integrationhprm.codeplex.com/SourceControl/latest#82/ADFSClient/ADFSClient/Program.cs">here</a>.</p>
<iframe src="https://player.vimeo.com/video/140376880" width="500" height="375" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe><h1>Refresh tokens</h1>
<p>A refresh token will allow a client to keep their credentials cached for days rather than hours however in my experience ADFS does not issue refresh tokens by default. You may wish to do some research on refresh tokens and decide whether or not you want to support them.  If yes then use the following powershel command to enable them for your relying party trust.  You can choose to issue refresh tokens to AllDevices or WorkplaceJoinedDevices.</p>
<pre class="source-code"><span class="cm-variable">Set</span><span class="cm-operator">-</span><span class="cm-variable">AdfsRelyingPartyTrust</span> <span class="cm-operator">-</span><span class="cm-variable">TargetName</span> <span class="cm-string">"davidc2012 ServiceAPI"</span> <span class="cm-operator">-</span><span class="cm-variable">IssueOAuthRefreshTokensTo</span> <span class="cm-variable">AllDevices</span></pre>
</body></html>
